<div class="user-management-container">
    <header class="header-section">
      <h2 class="section-title">User Management</h2>
      <mat-divider></mat-divider>
    </header>
  
    <div class="control-section">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search Users</mat-label>
        <input matInput 
               (keyup)="applyFilter($event)" 
               placeholder="Search by name, email, or role..."
               #input>
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>
    </div>
  
    <div class="table-container mat-elevation-z8">
      <table mat-table [dataSource]="dataSource" matSort class="user-table">
        <!-- Profile Picture Column -->
        <ng-container matColumnDef="profilePicture">
          <th mat-header-cell *matHeaderCellDef> Photo </th>
          <td mat-cell *matCellDef="let user">
            <img [src]="getProfileImage(user.profilePicture)" 
                 alt="Profile" 
                 class="profile-image">
          </td>
        </ng-container>

        <!-- Username Column -->
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Username </th>
          <td mat-cell *matCellDef="let user"> {{user.username}} </td>
        </ng-container>
  
        <!-- Email Column -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Email </th>
          <td mat-cell *matCellDef="let user"> {{user.email}} </td>
        </ng-container>
  
        <!-- Full Name Column -->
        <ng-container matColumnDef="fullName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Full Name </th>
          <td mat-cell *matCellDef="let user"> {{user.fullName}} </td>
        </ng-container>
  
        <!-- Birth Date Column -->
        <ng-container matColumnDef="birthDate">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Birth Date </th>
          <td mat-cell *matCellDef="let user"> {{user.birthDate | date:'short'}} </td>
        </ng-container>
  
        <!-- Joined On Column -->
        <ng-container matColumnDef="joinedOn">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Joined On </th>
          <td mat-cell *matCellDef="let user"> {{user.joinedOn | date:'short'}} </td>
        </ng-container>
  
        <!-- Last Login Column -->
        <ng-container matColumnDef="lastLogin">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Last Login </th>
          <td mat-cell *matCellDef="let user"> {{user.lastLogin | date:'short'}} </td>
        </ng-container>
  
        <!-- Roles Column -->
        <ng-container matColumnDef="roles">
          <th mat-header-cell *matHeaderCellDef> Roles </th>
          <td mat-cell *matCellDef="let user">
            <mat-chip-set>
              <mat-chip *ngIf="user.isClient" color="primary">Client</mat-chip>
              <mat-chip *ngIf="user.isGameDeveloper" color="accent">Developer</mat-chip>
              <mat-chip *ngIf="user.isAdmin" color="warn">Admin</mat-chip>
            </mat-chip-set>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Actions </th>
          <td mat-cell *matCellDef="let user">
            <button mat-icon-button
                    [color]="user.isAdmin ? 'warn' : 'primary'"
                    (click)="toggleAdminStatus(user.id, user.isAdmin)"
                    matTooltip="Toggle Admin Status">
              <mat-icon>admin_panel_settings</mat-icon>
            </button>
            <button mat-icon-button
                    [color]="user.isGameDeveloper ? 'warn' : 'accent'"
                    (click)="toggleDeveloperStatus(user.id, user.isGameDeveloper)"
                    matTooltip="Toggle Developer Status">
              <mat-icon>developer_mode</mat-icon>
            </button>
            <button mat-icon-button
                    color="warn"
                    (click)="deleteUser(user.id, user.username)"
                    matTooltip="Delete Account">
              <mat-icon>delete_forever</mat-icon>
            </button>
          </td>
        </ng-container>
  
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  
        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="7">No data matching the filter "{{input.value}}"</td>
        </tr>
      </table>
  
      <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" 
                     class="table-paginator"
                     aria-label="Select page of users">
      </mat-paginator>
    </div>
  </div>